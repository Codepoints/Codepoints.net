(function(a,b){b(".extended.searchform").each(function(){function k(c,d,e){var f=b('<ul class="query-choose"></ul>');b.each(d,function(a,d){f.append(b('<li><a class="button" href="#">'+d[1]+"</a></li>").on("click tap","a",function(){return e(c,d[1],d[0]),f.dialog("close").dialog("destroy").remove(),f=null,!1}))}),f.dialog({title:c,modal:!0,width:Math.min(b(a).width(),1030)})}function l(a,c,d){var e="",g=jQuery.noop;return d.is("select")?(e=" y",g=function(){return d.find('option[value=""]')[0].selected=!1,d.find('option[value="1"]')[0].selected?(d.find('option[value="1"]')[0].selected=!1,d.find('option[value="0"]')[0].selected=!0,b(this).find(".value").addClass("n").removeClass("y")):(d.find('option[value="0"]')[0].selected=!1,d.find('option[value="1"]')[0].selected=!0,b(this).find(".value").addClass("y").removeClass("n")),!1}):g=function(){var c=b(this),e=i[a];k(a,e,function(a,b,e){c.find(".value").text(b),d[0].checked=!1,e[0].checked=!0})},b('<li class="query-item"></li>').html('<span class="key">'+a+':</span> <span class="value'+e+'" title="click to change">'+c+'</span> <button type="button">remove</button>').find("button").button({text:!1,icons:{primary:"ui-icon-close",secondary:!1}}).on("click tab",function(){var a=b(this).closest("li");return d.is(":checkbox")?d[0].checked=!1:d.find('option[value=""]')[0].selected=!0,a.slideUp("fast",a.remove),!1}).end().on("click tab",g).tooltip().appendTo(f)}var c=b(this),d=b(".propsearch, .boolsearch",c).hide(),e=b(".submitset",c),f=b('<ul class="query-add ui-widget ui-widget-content ui-corner-all"></ul>').insertBefore(e),g=b(),h=b('<p><button type="button">+ add new query</button></p>').insertBefore(e).find("button"),i={},j=b('<ul class="ui-menu ui-widget ui-widget-content" tabindex="0"></ul>');d.filter(".propsearch").each(function(){var a=b(this),c=[],d=b("legend",a).text().replace(/:\s*$/,"");b(":checkbox",a).each(function(){var e=b(this),f=b('label[for="'+this.id+'"]',a).text();c.push([e,f]),e[0].checked&&l(d,f,e)}),i[d]=c}),i["Other Property"]=[],d.filter(".boolsearch").each(function(){var a=b("select",this),c=b("label",this).text();i["Other Property"].push([a,c]),a.find('option[value="1"]')[0].selected&&l("Other Property",c,a)}),b.each(i,function(a,c){j.append(b('<li class="ui-menu-item"><a href="#">'+a+"</a></li>").data("v",c).data("k",a))}),b(document).on("keydown click tap",function(){j.slideUp()}),j.css({display:"none",position:"absolute"}).appendTo("body").on("click tap","li",function(){var a=b(this);return k(a.data("k"),a.data("v"),function(a,b,c){c.is(":checkbox")?c[0].checked=!0:c.find('option[value="1"]')[0].selected=!0,l(a,b,c)}),j.slideUp(),!1}).on("keydown",function(a){if(!a.shiftKey&&!a.metaKey&&!a.ctrlKey&&!a.altKey){var c=j.find("a:focus"),d=b();switch(a.which){case 38:c.length&&(d=c.parent().prev("li").find("a")),d.length||(d=j.find("a:last"));break;case 40:c.length&&(d=c.parent().next("li").find("a")),d.length||(d=j.find("a:first"))}if(d.length)return d.focus(),a.preventDefault(),a.stopPropagation(),!1}}),h.on("click tap",function(){return j.show().position({my:"left top",at:"left bottom",of:this,colision:"fit flip"}).hide().slideDown().focus(),!1}),f.on("click tap",function(a){if(a.target===this)return h.trigger("click"),!1})})})(this,jQuery);